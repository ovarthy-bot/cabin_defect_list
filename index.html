<!DOCTYPE html>
<html lang="tr">

<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>UÃ§ak Defect Takip (Firebase)</title>
Â  Â  <style>
Â  Â  Â  Â  /* --- GENEL STÄ°LLER (AYNEN KORUNDU VE GÃœNCELLENDÄ°) --- */
Â  Â  Â  Â  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; display: flex; overflow-x: hidden; transition: background-color 0.3s, color 0.3s; }
Â  Â  Â  Â  .sidebar { height: 100%; width: 0; position: fixed; top: 0; left: 0; background-color: #333; overflow-x: hidden; transition: 0.3s; padding-top: 60px; color: white; z-index: 1001; }
Â  Â  Â  Â  .sidebar.open { width: 250px; }
Â  Â  Â  Â  .sidebar .close-btn { position: absolute; top: 10px; right: 25px; font-size: 36px; cursor: pointer; }
Â  Â  Â  Â  .sidebar-content { padding: 20px; }
Â  Â  Â  Â  .sidebar-content label { display: block; margin-bottom: 10px; font-weight: bold; }
Â  Â  Â  Â  .sidebar-content input, .sidebar-content select, .sidebar-content button { width: 100%; padding: 8px; margin-bottom: 20px; border: none; border-radius: 4px; cursor: pointer; }
Â  Â  Â  Â  .sidebar-content button { background-color: #4CAF50; color: white; }
Â  Â  Â  Â  .sidebar-content button:hover { background-color: #45a049; }
Â  Â  Â  Â  .menu-btn { position: fixed; top: 10px; left: 10px; font-size: 24px; cursor: pointer; background-color: #007bff; color: white; padding: 5px 10px; border-radius: 4px; z-index: 1000; transition: background-color 0.3s; }
Â  Â  Â  Â  .container { max-width: 800px; margin: 20px auto; padding: 20px; background-color: #fff; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); border-radius: 8px; transition: margin-left 0.3s, background-color 0.3s, color 0.3s; text-align: center; }
Â  Â  Â  Â  .container.sidebar-open { margin-left: 250px; }
Â  Â  Â  Â  .email-info { position: absolute; top: 10px; right: 10px; font-size: 12px; color: #555; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* UÃ§ak YÃ¶netimi Stilleri */
Â  Â  Â  Â  .airplane-management { display: flex; gap: 5px; margin-bottom: 15px; align-items: flex-end;}
Â  Â  Â  Â  .airplane-management select { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
Â  Â  Â  Â  .airplane-btn { padding: 10px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; min-width: 40px;}
Â  Â  Â  Â  .airplane-btn.delete { background-color: #dc3545; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .input-section label { display: block; margin-top: 10px; font-weight: bold; text-align: left;}
Â  Â  Â  Â  .input-section input, .input-section select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; box-sizing: border-box; }
Â  Â  Â  Â  .input-section button.main-save-btn { display: block; width: 100%; padding: 10px; margin-top: 20px; background-color: #007bff; color: #fff; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; }
Â  Â  Â  Â  .input-section button.main-save-btn:hover { background-color: #000000; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .list-section { margin-top: 20px; }
Â  Â  Â  Â  #defect-list { list-style-type: none; padding: 0; }
Â  Â  Â  Â  #defect-list li { margin-bottom: 15px; padding: 15px; background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 4px; display: flex; flex-direction: row; align-items: flex-start; justify-content: space-between; position: relative;}
Â  Â  Â  Â  #defect-list img { width: 100px; height: 100px; margin-right: 15px; border-radius: 4px; object-fit: cover; cursor: pointer; }
Â  Â  Â  Â  #defect-list .defect-details { flex-grow: 1; text-align: left; }
Â  Â  Â  Â  #defect-list .defect-details div { margin: 5px 0; font-size: 14px; }
Â  Â  Â  Â  #defect-list .defect-details .label { font-weight: bold; color: #333; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .buttons { display: flex; gap: 10px; align-self: flex-end; }
Â  Â  Â  Â  .shortcut-buttons { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
Â  Â  Â  Â  .shortcut-buttons button { padding: 5px 10px; border: none; background-color: #333; color: white; border-radius: 3px; cursor: pointer; font-size: 12px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .export-button, .import-button { width: 100%; padding: 10px; margin-top: 10px; color: #fff; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; }
Â  Â  Â  Â  .export-button { background-color: #28a745; }
Â  Â  Â  Â  .import-button { background-color: #bbcd1a; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .image-upload-options { display: flex; gap: 10px; margin-top: 5px; justify-content: center; }
Â  Â  Â  Â  .image-upload-options button { width: 40px; height: 40px; border-radius: 4px; background-color: #6c757d; border: none; color: white; cursor: pointer; position: relative; font-size: 20px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .suggestion-list { position: absolute; background-color: #fff; border: 1px solid #ccc; max-height: 200px; overflow-y: auto; width: 90%; z-index: 1000; display: none; text-align: left; }
Â  Â  Â  Â  .suggestion-list div { padding: 8px; cursor: pointer; }
Â  Â  Â  Â  .suggestion-list div:hover { background-color: #f0f0f0; }

Â  Â  Â  Â  /* Loader */
Â  Â  Â  Â  .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 2s linear infinite; display: none; margin: 0 auto;}
Â  Â  Â  Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

Â  Â  Â  Â  /* Dark Theme overrides */
Â  Â  Â  Â  body.dark-theme { background-color: #1a1a1a; color: #fff; }
Â  Â  Â  Â  .dark-theme .container { background-color: #2d2d2d; color: #fff; }
Â  Â  Â  Â  .dark-theme .input-section input, .dark-theme .input-section select { background-color: #3a3a3a; color: #fff; border-color: #555; }
Â  Â  Â  Â  .dark-theme #defect-list li { background-color: #3a3a3a; border-color: #555; }
Â  Â  Â  Â  .dark-theme .defect-details .label { color: #ccc; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  @media (max-width: 600px) {
Â  Â  Â  Â  Â  Â  .container { margin-left: 0; padding: 10px; }
Â  Â  Â  Â  Â  Â  .container.sidebar-open { margin-left: 0; transform: translateX(250px); }
Â  Â  Â  Â  Â  Â  #defect-list li { flex-direction: column; }
Â  Â  Â  Â  Â  Â  #defect-list .buttons { width: 100%; justify-content: space-between; margin-top: 10px; }
Â  Â  Â  Â  Â  Â  .airplane-management { flex-wrap: wrap; }
Â  Â  Â  Â  Â  Â  .airplane-management select { width: 100%; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>

<body>
Â  Â  <div class="menu-btn" onclick="toggleSidebar()">â˜°</div>
Â  Â Â 
Â  Â  <div class="sidebar" id="sidebar">
Â  Â  Â  Â  <span class="close-btn" onclick="toggleSidebar()">Ã—</span>
Â  Â  Â  Â  <div class="sidebar-content">
Â  Â  Â  Â  Â  Â  <label for="image-scale">Resim Kalitesi (0.1 - 1):</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="image-scale" step="0.1" min="0.1" max="1" value="0.5">
Â  Â  Â  Â  Â  Â  <label for="theme-select">Tema:</label>
Â  Â  Â  Â  Â  Â  <select id="theme-select" onchange="changeTheme()">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="light" selected>AÃ§Ä±k Tema</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="dark">KaranlÄ±k Tema</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  <button onclick="alert('Bu Ã¶zellik ÅŸu an bakÄ±mda.')">Koltuk No SÄ±rala</button>
Â  Â  Â  Â  Â  Â  <div style="margin-top: 20px; font-size: 12px; color: #aaa;">Firebase Connected</div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="email-info">ovar@thy.com</div>

Â  Â  <div class="container" id="main-container">
Â  Â  Â  Â  <div class="input-section">
Â  Â  Â  Â  Â  Â  <label for="airplane-select">UÃ‡AK SEÃ‡Ä°MÄ° (FÄ°LTRE):</label>
Â  Â  Â  Â  Â  Â  <div class="airplane-management">
Â  Â  Â  Â  Â  Â  Â  Â  <select id="airplane-select" onchange="filterByAirplane()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>UÃ§ak SeÃ§iniz veya Ekleyiniz</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="airplane-btn" onclick="addNewAirplane()" title="Yeni UÃ§ak Ekle">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="airplane-btn delete" onclick="deleteSelectedAirplane()" title="SeÃ§ili UÃ§aÄŸÄ± Sil">-</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <label for="defect">DEFECT:</label>
Â  Â  Â  Â  Â  Â  <div class="shortcut-buttons">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="addShortcut('DAMAGED')">DAMAGED âš’ï¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="addShortcut('DISLOCATED')">DISLOCATED â†”ï¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="addShortcut('LOOSE')">LOOSE ğŸ”§</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="addShortcut('NOT WORKING')">NOT WORKING âŒ</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <input type="text" id="defect" placeholder="Defect giriniz" autocomplete="off"
Â  Â  Â  Â  Â  Â  Â  Â  oninput="this.value = this.value.toUpperCase(); showSuggestions(this.value)">
Â  Â  Â  Â  Â  Â  <div id="suggestion-list" class="suggestion-list"></div>

Â  Â  Â  Â  Â  Â  <label for="location">LOCATION:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="location" placeholder="Location giriniz" oninput="handleUpperCase(this)">

Â  Â  Â  Â  Â  Â  <label for="note">NOTE:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="note" placeholder="Note giriniz" oninput="handleUpperCase(this)">

Â  Â  Â  Â  Â  Â  <label for="partNumber">P/N:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="partNumber" placeholder="Part Number giriniz" oninput="handleUpperCase(this)">

Â  Â  Â  Â  Â  Â  <label for="manHours">M/H:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="manHours" placeholder="Man Hours giriniz" oninput="handleUpperCase(this)">

Â  Â  Â  Â  Â  Â  <label>Resim YÃ¼kle:</label>
Â  Â  Â  Â  Â  Â  <div class="image-upload-options">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="document.getElementById('camera-upload').click()">ğŸ“·</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="document.getElementById('gallery-upload').click()">ğŸ–¼ï¸</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <input type="file" id="camera-upload" accept="image/*" capture="environment" style="display: none;" onchange="handleImageUpload(event)">
Â  Â  Â  Â  Â  Â  <input type="file" id="gallery-upload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="image-preview-container" style="display:none; margin-top:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <img id="preview-img" style="width: 100px; height: 100px; object-fit: cover; border-radius: 4px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="clearImageSelection()" style="background:red; color:white; border:none; border-radius:50%; width:20px; height:20px; cursor:pointer;">x</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button onclick="saveDefectToFirebase()" class="main-save-btn">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="save-text">Kaydet</span>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="save-loader" class="loader"></div>
Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  <label for="search">Arama (Mevcut Liste Ä°Ã§inde):</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="search" placeholder="Arama yapÄ±n" oninput="searchLocalList()">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="list-section">
Â  Â  Â  Â  Â  Â  <h2 id="list-header">Kaydedilen Defectler</h2>
Â  Â  Â  Â  Â  Â  <ul id="defect-list"></ul>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button class="export-button" onclick="exportToExcel()">Listeyi Excele Aktar</button>
Â  Â  Â  Â  </div>

Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>

Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
Â  Â  Â  Â  import { getFirestore, collection, addDoc, getDocs, onSnapshot, query, where, deleteDoc, doc, updateDoc, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
Â  Â  Â  Â  import { getStorage, ref, uploadString, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

Â  Â  Â  Â  // --- BURAYI DOLDURUN: KENDÄ° FIREBASE PROJE BÄ°LGÄ°LERÄ°NÄ°Z ---
Â  Â  Â  Â  // Your web app's Firebase configuration
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  apiKey: "AIzaSyAXKtBrHzw5P6vO0MwzrD-TJdm7t6heLpg",
Â  Â  Â  Â  authDomain: "cabin-defect-list-5594c.firebaseapp.com",
Â  Â  Â  Â  projectId: "cabin-defect-list-5594c",
Â  Â  Â  Â  storageBucket: "cabin-defect-list-5594c.firebasestorage.app",
Â  Â  Â  Â  messagingSenderId: "1074016655708",
Â  Â  Â  Â  appId: "1:1074016655708:web:dd74b52b089ae272098999"
Â  Â  Â  Â  };
Â  Â  Â  Â  // -----------------------------------------------------------

Â  Â  Â  Â  // Firebase BaÅŸlatma
Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const db = getFirestore(app);
Â  Â  Â  Â  const storage = getStorage(app);

Â  Â  Â  Â  // Global DeÄŸiÅŸkenler (ModÃ¼l dÄ±ÅŸÄ±na aktarmak iÃ§in window'a atÄ±yoruz)
Â  Â  Â  Â  window.db = db;
Â  Â  Â  Â  window.storage = storage;
Â  Â  Â  Â  window.collection = collection;
Â  Â  Â  Â  window.addDoc = addDoc;
Â  Â  Â  Â  window.getDocs = getDocs;
Â  Â  Â  Â  window.onSnapshot = onSnapshot;
Â  Â  Â  Â  window.query = query;
Â  Â  Â  Â  window.where = where;
Â  Â  Â  Â  window.deleteDoc = deleteDoc;
Â  Â  Â  Â  window.doc = doc;
Â  Â  Â  Â  window.updateDoc = updateDoc;
Â  Â  Â  Â  window.orderBy = orderBy;
Â  Â  Â  Â  window.serverTimestamp = serverTimestamp;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Storage fonksiyonlarÄ±
Â  Â  Â  Â  window.ref = ref;
Â  Â  Â  Â  window.uploadString = uploadString;
Â  Â  Â  Â  window.getDownloadURL = getDownloadURL;
Â  Â  Â  Â  window.deleteObject = deleteObject;

Â  Â  Â  Â  // Sayfa yÃ¼klendiÄŸinde uÃ§aklarÄ± getir
Â  Â  Â  Â  loadAirplanes();
Â  Â  </script>

Â  Â  <script>
Â  Â  Â  Â  // --- DEÄÄ°ÅKENLER ---
Â  Â  Â  Â  let selectedImageBase64 = null;
Â  Â  Â  Â  let currentEditingId = null;
Â  Â  Â  Â  let unsubscribeDefects = null; // Listener'Ä± kapatmak iÃ§in
Â  Â  Â  Â  let currentDefectsData = []; // Excel export ve arama iÃ§in
Â  Â  Â  Â  const suggestions = [
Â  Â  Â  Â  Â  Â  "LAVATORY DOORS INNER MIRRORS ARE DAMAGED",
Â  Â  Â  Â  Â  Â  "LAVATORY WASTE DOOR HINGE SCREWS ARE MISSING",
Â  Â  Â  Â  Â  Â  "LAVATORY WASTE DOORS ARE NOT ADJUSTED",
Â  Â  Â  Â  Â  Â  "LAVATORY DOOR GRILLS ARE DIRTY",
Â  Â  Â  Â  Â  Â  "LAVATORY INNER DOOR LATCHES ARE NOT WORKING PROPERLY",
Â  Â  Â  Â  Â  Â  "LAVATORY FLOOR PANS ARE DAMAGED",
Â  Â  Â  Â  Â  Â  "LAVATORY CABINET SERVICE PANEL HINGES ARE DAMAGED",
Â  Â  Â  Â  Â  Â  "LAVATORY CEILING LENSES ARE DISLOCATED",
Â  Â  Â  Â  Â  Â  "LAVATORY PAPER HOLDER ROLLERS ARE DAMAGED",
Â  Â  Â  Â  Â  Â  "LAVATORY INNER AISLE SIDE WALL LOWER SURFACES ARE CORRODED",
Â  Â  Â  Â  Â  Â  "LAVATORY DOORS ARE NOT ADJUSTED",
Â  Â  Â  Â  Â  Â  "LAVATORY PLACARDS ARE MISSING"
Â  Â  Â  Â  ];

Â  Â  Â  Â  // --- UÃ‡AK YÃ–NETÄ°MÄ° (KATEGORÄ° YERÄ°NE) ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function loadAirplanes() {
Â  Â  Â  Â  Â  Â  // Firebase modÃ¼lÃ¼ yÃ¼klenene kadar bekle
Â  Â  Â  Â  Â  Â  if (!window.db) { setTimeout(loadAirplanes, 500); return; }

Â  Â  Â  Â  Â  Â  const airplaneSelect = document.getElementById("airplane-select");
Â  Â  Â  Â  Â  Â  // Mevcut seÃ§enekleri temizle ama ilkini tut
Â  Â  Â  Â  Â  Â  airplaneSelect.innerHTML = '<option value="" disabled selected>UÃ§ak SeÃ§iniz</option>';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const q = window.query(window.collection(window.db, "airplanes"), window.orderBy("name"));
Â  Â  Â  Â  Â  Â  Â  Â  const querySnapshot = await window.getDocs(q);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  querySnapshot.forEach((doc) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const opt = document.createElement("option");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.value = doc.data().name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.text = doc.data().name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opt.dataset.id = doc.id; // Silme iÅŸlemi iÃ§in ID'yi sakla
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  airplaneSelect.appendChild(opt);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // EÄŸer localStorage'da son seÃ§ilen varsa onu seÃ§
Â  Â  Â  Â  Â  Â  Â  Â  const lastPlane = localStorage.getItem("lastSelectedPlane");
Â  Â  Â  Â  Â  Â  Â  Â  if(lastPlane) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  airplaneSelect.value = lastPlane;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  filterByAirplane();
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("UÃ§aklar yÃ¼klenirken hata:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert("VeritabanÄ± baÄŸlantÄ±sÄ± kurulamadÄ±. Firebase ayarlarÄ±nÄ± kontrol edin.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function addNewAirplane() {
Â  Â  Â  Â  Â  Â  const planeName = prompt("Yeni eklenecek UÃ‡AK ismini giriniz (Ã–rn: TC-LGA):");
Â  Â  Â  Â  Â  Â  if (!planeName) return;
Â  Â  Â  Â  Â  Â  const upperName = planeName.toUpperCase().trim();

Â  Â  Â  Â  Â  Â  if (!window.db) { alert("VeritabanÄ± hazÄ±r deÄŸil"); return; }

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // MÃ¼kerrer kontrolÃ¼
Â  Â  Â  Â  Â  Â  Â  Â  const q = window.query(window.collection(window.db, "airplanes"), window.where("name", "==", upperName));
Â  Â  Â  Â  Â  Â  Â  Â  const snap = await window.getDocs(q);
Â  Â  Â  Â  Â  Â  Â  Â  if (!snap.empty) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Bu uÃ§ak zaten listede var.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  await window.addDoc(window.collection(window.db, "airplanes"), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: upperName,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAt: window.serverTimestamp()
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Listeyi yenile
Â  Â  Â  Â  Â  Â  Â  Â  await loadAirplanes();
Â  Â  Â  Â  Â  Â  Â  Â  // Yeni eklenen uÃ§aÄŸÄ± seÃ§
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("airplane-select").value = upperName;
Â  Â  Â  Â  Â  Â  Â  Â  filterByAirplane();

Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Hata:", e);
Â  Â  Â  Â  Â  Â  Â  Â  alert("UÃ§ak eklenemedi: " + e.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function deleteSelectedAirplane() {
Â  Â  Â  Â  Â  Â  const select = document.getElementById("airplane-select");
Â  Â  Â  Â  Â  Â  const selectedPlane = select.value;
Â  Â  Â  Â  Â  Â  const selectedOption = select.options[select.selectedIndex];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!selectedPlane) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Silmek iÃ§in bir uÃ§ak seÃ§melisiniz.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (!confirm(`${selectedPlane} uÃ§aÄŸÄ±nÄ± ve LÄ°STEDEN SÄ°LMEK istediÄŸinize emin misiniz? (Bu iÅŸlem sadece uÃ§ak ismini listeden kaldÄ±rÄ±r, defect kayÄ±tlarÄ± veritabanÄ±nda kalÄ±r ama listede gÃ¶rÃ¼nmez)`)) {
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const id = selectedOption.dataset.id;
Â  Â  Â  Â  Â  Â  Â  Â  await window.deleteDoc(window.doc(window.db, "airplanes", id));
Â  Â  Â  Â  Â  Â  Â  Â  alert(`${selectedPlane} silindi.`);
Â  Â  Â  Â  Â  Â  Â  Â  select.value = "";
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem("lastSelectedPlane");
Â  Â  Â  Â  Â  Â  Â  Â  loadAirplanes();
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("defect-list").innerHTML = ""; // Listeyi temizle
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Silme hatasÄ±:", e);
Â  Â  Â  Â  Â  Â  Â  Â  alert("Silinirken hata oluÅŸtu.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function filterByAirplane() {
Â  Â  Â  Â  Â  Â  const plane = document.getElementById("airplane-select").value;
Â  Â  Â  Â  Â  Â  if (!plane) return;

Â  Â  Â  Â  Â  Â  localStorage.setItem("lastSelectedPlane", plane);
Â  Â  Â  Â  Â  Â  document.getElementById("list-header").innerText = `${plane} Ä°Ã§in KayÄ±tlar`;

Â  Â  Â  Â  Â  Â  // Ã–nceki listener varsa kapat
Â  Â  Â  Â  Â  Â  if (unsubscribeDefects) {
Â  Â  Â  Â  Â  Â  Â  Â  unsubscribeDefects();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // --- DEÄÄ°ÅÄ°KLÄ°K BURADA ---
Â  Â  Â  Â  Â  Â  // "orderBy" kÄ±smÄ±nÄ± kaldÄ±rdÄ±k. ArtÄ±k hata vermeyecek.
Â  Â  Â  Â  Â  Â  // Veriler karÄ±ÅŸÄ±k sÄ±rada gelebilir ama sistem Ã§alÄ±ÅŸÄ±r.
Â  Â  Â  Â  Â  Â  const q = window.query(
Â  Â  Â  Â  Â  Â  Â  Â  window.collection(window.db, "defects"),Â 
Â  Â  Â  Â  Â  Â  Â  Â  window.where("airplane", "==", plane)
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  // -------------------------

Â  Â  Â  Â  Â  Â  const listEl = document.getElementById("defect-list");
Â  Â  Â  Â  Â  Â  listEl.innerHTML = '<li style="text-align:center;">YÃ¼kleniyor...</li>';

Â  Â  Â  Â  Â  Â  unsubscribeDefects = window.onSnapshot(q, (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  listEl.innerHTML = "";
Â  Â  Â  Â  Â  Â  Â  Â  currentDefectsData = [];Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (snapshot.empty) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listEl.innerHTML = '<li style="text-align:center;">Bu uÃ§ak iÃ§in henÃ¼z kayÄ±t yok.</li>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Verileri client tarafÄ±nda (tarayÄ±cÄ±da) sÄ±ralayalÄ±m
Â  Â  Â  Â  Â  Â  Â  Â  // BÃ¶ylece veritabanÄ± indeksi istemez ama yine de yeni kayÄ±t en Ã¼ste gelir
Â  Â  Â  Â  Â  Â  Â  Â  let tempDocs = [];
Â  Â  Â  Â  Â  Â  Â  Â  snapshot.forEach((doc) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let d = doc.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  d.id = doc.id;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tempDocs.push(d);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // JavaScript ile sÄ±ralama (En yeni en Ã¼stte)
Â  Â  Â  Â  Â  Â  Â  Â  tempDocs.sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!a.createdAt || !b.createdAt) return 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return b.createdAt.seconds - a.createdAt.seconds;
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  tempDocs.forEach((data) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentDefectsData.push(data);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderDefectItem(data);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Veri Ã§ekme hatasÄ±:", error);
Â  Â  Â  Â  Â  Â  Â  Â  listEl.innerHTML = "Veriler alÄ±namadÄ±: " + error.message;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderDefectItem(data) {
Â  Â  Â  Â  Â  Â  const listEl = document.getElementById("defect-list");
Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let imageHtml = '';
Â  Â  Â  Â  Â  Â  if (data.imageUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  imageHtml = `<img src="${data.imageUrl}" onclick="window.open('${data.imageUrl}', '_blank')">`;
Â  Â  Â  Â  Â  Â  } else if (data.image) {
Â  Â  Â  Â  Â  Â  Â  Â  // Eski base64 desteÄŸi (migrate edilmemiÅŸ veriler iÃ§in)
Â  Â  Â  Â  Â  Â  Â  Â  imageHtml = `<img src="${data.image}" onclick="window.open('${data.image}', '_blank')">`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  li.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  ${imageHtml}
Â  Â  Â  Â  Â  Â  Â  Â  <div class="defect-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><span class="label">UÃ‡AK:</span> ${data.airplane}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><span class="label">DEFECT:</span> ${data.defect}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><span class="label">LOCATION:</span> ${data.location}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${data.note ? `<div><span class="label">NOTE:</span> ${data.note}</div>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${data.partNumber ? `<div><span class="label">P/N:</span> ${data.partNumber}</div>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${data.manHours ? `<div><span class="label">M/H:</span> ${data.manHours}</div>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="buttons">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="airplane-btn" style="background-color:#ffc107; color:black" onclick="prepareEdit('${data.id}')">âœï¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="airplane-btn delete" onclick="deleteDefect('${data.id}', '${data.imageUrl}')">ğŸ—‘ï¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  listEl.appendChild(li);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- CRUD Ä°ÅLEMLERÄ° (FIREBASE) ---

Â  Â  Â  Â  async function saveDefectToFirebase() {
Â  Â  Â  Â  Â  Â  const airplane = document.getElementById('airplane-select').value;
Â  Â  Â  Â  Â  Â  const defect = document.getElementById('defect').value;
Â  Â  Â  Â  Â  Â  const location = document.getElementById('location').value;
Â  Â  Â  Â  Â  Â  const note = document.getElementById('note').value;
Â  Â  Â  Â  Â  Â  const partNumber = document.getElementById('partNumber').value;
Â  Â  Â  Â  Â  Â  const manHours = document.getElementById('manHours').value;

Â  Â  Â  Â  Â  Â  if (!airplane) { alert("LÃ¼tfen bir UÃ‡AK seÃ§iniz."); return; }
Â  Â  Â  Â  Â  Â  if (!defect || !location) { alert("Defect ve Location alanlarÄ± zorunludur."); return; }

Â  Â  Â  Â  Â  Â  const btn = document.querySelector('.main-save-btn');
Â  Â  Â  Â  Â  Â  const loader = document.getElementById('save-loader');
Â  Â  Â  Â  Â  Â  const btnText = document.getElementById('save-text');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  Â  Â  Â  btnText.style.display = 'none';
Â  Â  Â  Â  Â  Â  loader.style.display = 'block';

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  let imageUrl = "";

Â  Â  Â  Â  Â  Â  Â  Â  // Resim yÃ¼kleme iÅŸlemi
Â  Â  Â  Â  Â  Â  Â  Â  if (selectedImageBase64) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const storageRef = window.ref(window.storage, `defect_images/${Date.now()}_${Math.random().toString(36).substr(2, 9)}.jpg`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await window.uploadString(storageRef, selectedImageBase64, 'data_url');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imageUrl = await window.getDownloadURL(storageRef);
Â  Â  Â  Â  Â  Â  Â  Â  } else if (currentEditingId && currentDefectsData.find(d => d.id === currentEditingId)?.imageUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // DÃ¼zenleme yapÄ±lÄ±yor ve yeni resim seÃ§ilmediyse eskisini koru
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imageUrl = currentDefectsData.find(d => d.id === currentEditingId).imageUrl;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const defectObj = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  airplane,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  defect,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  location,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  note,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partNumber,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  manHours,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imageUrl: imageUrl,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAt: window.serverTimestamp() // SÄ±ralama iÃ§in
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  if (currentEditingId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // GÃ¼ncelleme
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const docRef = window.doc(window.db, "defects", currentEditingId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // createdAt gÃ¼ncelleme sÄ±rasÄ±nda deÄŸiÅŸmesin
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  delete defectObj.createdAt;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await window.updateDoc(docRef, defectObj);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("KayÄ±t gÃ¼ncellendi!");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentEditingId = null;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Yeni KayÄ±t
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await window.addDoc(window.collection(window.db, "defects"), defectObj);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // alert("KayÄ±t baÅŸarÄ±lÄ±!"); // Snapshot listener otomatik gÃ¼ncelleyeceÄŸi iÃ§in alert opsiyonel
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  clearForm();

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Kaydetme hatasÄ±:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert("Hata oluÅŸtu: " + error.message);
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  btnText.style.display = 'inline';
Â  Â  Â  Â  Â  Â  Â  Â  loader.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  btnText.innerText = "Kaydet";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function deleteDefect(id, imageUrl) {
Â  Â  Â  Â  Â  Â  if (!confirm("Bu kaydÄ± ve RESMÄ° kalÄ±cÄ± olarak silmek istediÄŸinize emin misiniz?")) return;

Â  Â  Â  Â  Â  Â  // YÃ¼kleme animasyonu ekleyelim (Butonun ikonunu deÄŸiÅŸtirerek)
Â  Â  Â  Â  Â  Â  const listEl = document.getElementById("defect-list");
Â  Â  Â  Â  Â  Â  // KullanÄ±cÄ±ya iÅŸlemin baÅŸladÄ±ÄŸÄ±nÄ± hissettirmek iÃ§in basit bir yÃ¶ntem
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // 1. Ã–nce VeritabanÄ± KaydÄ±nÄ± Sil
Â  Â  Â  Â  Â  Â  Â  Â  await window.deleteDoc(window.doc(window.db, "defects", id));

Â  Â  Â  Â  Â  Â  Â  Â  // 2. EÄŸer Resim Varsa ve Firebase Linki Ä°se Storage'dan da Sil
Â  Â  Â  Â  Â  Â  Â  Â  if (imageUrl && imageUrl.startsWith("https://firebasestorage")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // URL'den referans oluÅŸturup silme iÅŸlemi
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imageRef = window.ref(window.storage, imageUrl);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await window.deleteObject(imageRef);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Resim baÅŸarÄ±yla silindi.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (imgError) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Resim silinemedi (Zaten silinmiÅŸ olabilir):", imgError);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Resim silinmese bile kayÄ±t silindiÄŸi iÃ§in akÄ±ÅŸÄ± bozmuyoruz.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  alert("KayÄ±t ve resim baÅŸarÄ±yla silindi.");

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Silme hatasÄ±:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert("Silinirken bir hata oluÅŸtu: " + error.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function prepareEdit(id) {
Â  Â  Â  Â  Â  Â  const data = currentDefectsData.find(d => d.id === id);
Â  Â  Â  Â  Â  Â  if (!data) return;

Â  Â  Â  Â  Â  Â  document.getElementById('airplane-select').value = data.airplane; // UÃ§ak deÄŸiÅŸirse uyarabilir
Â  Â  Â  Â  Â  Â  document.getElementById('defect').value = data.defect;
Â  Â  Â  Â  Â  Â  document.getElementById('location').value = data.location;
Â  Â  Â  Â  Â  Â  document.getElementById('note').value = data.note || "";
Â  Â  Â  Â  Â  Â  document.getElementById('partNumber').value = data.partNumber || "";
Â  Â  Â  Â  Â  Â  document.getElementById('manHours').value = data.manHours || "";
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  currentEditingId = id;
Â  Â  Â  Â  Â  Â  document.querySelector('.main-save-btn span').innerText = "GÃ¼ncelle";
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (data.imageUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('image-preview-container').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('preview-img').src = data.imageUrl;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.querySelector('.container').scrollIntoView({ behavior: 'smooth' });
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- YARDIMCI FONKSÄ°YONLAR ---

Â  Â  Â  Â  function handleUpperCase(input) {
Â  Â  Â  Â  Â  Â  input.value = input.value.toUpperCase();
Â  Â  Â  Â  }

Â  Â  Â  Â  function addShortcut(text) {
Â  Â  Â  Â  Â  Â  let defectInput = document.getElementById("defect");
Â  Â  Â  Â  Â  Â  if (defectInput.value.trim() !== "") {
Â  Â  Â  Â  Â  Â  Â  Â  defectInput.value += " IS " + text;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  defectInput.value = text;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  document.getElementById('location').focus();
Â  Â  Â  Â  }

Â  Â  Â  Â  function clearForm() {
Â  Â  Â  Â  Â  Â  document.getElementById('defect').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('location').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('note').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('partNumber').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('manHours').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('camera-upload').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('gallery-upload').value = '';
Â  Â  Â  Â  Â  Â  clearImageSelection();
Â  Â  Â  Â  Â  Â  document.getElementById('save-text').innerText = "Kaydet";
Â  Â  Â  Â  Â  Â  currentEditingId = null;
Â  Â  Â  Â  }

Â  Â  Â  Â  function clearImageSelection() {
Â  Â  Â  Â  Â  Â  selectedImageBase64 = null;
Â  Â  Â  Â  Â  Â  document.getElementById('image-preview-container').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('preview-img').src = '';
Â  Â  Â  Â  }

Â  Â  Â  Â  function handleImageUpload(event) {
Â  Â  Â  Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  Â  Â  Â  if (!file) return;

Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  reader.onload = function (e) {
Â  Â  Â  Â  Â  Â  Â  Â  const scale = parseFloat(document.getElementById("image-scale").value) || 0.5;
Â  Â  Â  Â  Â  Â  Â  Â  resizeImage(e.target.result, scale).then(resizedImage => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedImageBase64 = resizedImage;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('image-preview-container').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('preview-img').src = resizedImage;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  }

Â  Â  Â  Â  function resizeImage(imageSrc, scale) {
Â  Â  Â  Â  Â  Â  return new Promise((resolve) => {
Â  Â  Â  Â  Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  Â  Â  Â  Â  img.src = imageSrc;
Â  Â  Â  Â  Â  Â  Â  Â  img.onload = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const canvas = document.createElement('canvas');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newWidth = img.width * scale;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newHeight = img.height * scale;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.width = newWidth;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.height = newHeight;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ctx.drawImage(img, 0, 0, newWidth, newHeight);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resolve(canvas.toDataURL('image/jpeg', 0.8)); // JPEG formatÄ±nda sÄ±kÄ±ÅŸtÄ±r
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function searchLocalList() {
Â  Â  Â  Â  Â  Â  const term = document.getElementById('search').value.toUpperCase();
Â  Â  Â  Â  Â  Â  const listEl = document.getElementById('defect-list');
Â  Â  Â  Â  Â  Â  listEl.innerHTML = "";
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const filtered = currentDefectsData.filter(d =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  (d.defect && d.defect.includes(term)) ||
Â  Â  Â  Â  Â  Â  Â  Â  (d.location && d.location.includes(term)) ||
Â  Â  Â  Â  Â  Â  Â  Â  (d.note && d.note.includes(term))
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  filtered.forEach(data => renderDefectItem(data));
Â  Â  Â  Â  }

Â  Â  Â  Â  function showSuggestions(val) {
Â  Â  Â  Â  Â  Â  const list = document.getElementById("suggestion-list");
Â  Â  Â  Â  Â  Â  list.innerHTML = "";
Â  Â  Â  Â  Â  Â  list.style.display = "none";
Â  Â  Â  Â  Â  Â  if (!val.trim()) return;

Â  Â  Â  Â  Â  Â  const matches = suggestions.filter(s => s.includes(val));
Â  Â  Â  Â  Â  Â  if (matches.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  list.style.display = "block";
Â  Â  Â  Â  Â  Â  Â  Â  matches.forEach(s => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement("div");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.innerText = s;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("defect").value = s;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.style.display = "none";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("location").focus();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.appendChild(div);
Â  Â  Â  Â  Â  
